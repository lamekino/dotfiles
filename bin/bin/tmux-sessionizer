#!/bin/bash
# modified from:
# https://github.com/ThePrimeagen/.dotfiles/blob/master/bin/.local/bin/tmux-sessionizer

confirm() {
    clear
    printf "Confirm:\n\n"
    printf ">>> Session name: %s\n" "$1"
    printf ">>> Session path: %s\n" "$2"
    [ -n "$3" ] \
        && printf ">>> Session command: '%s'\n" "$3" \
        || printf ">>> Session shell: %s\n" "$SHELL"

    printf "\nIs this OK? [Y/n] "
    read -r prompt
    [[ "$prompt" =~ ^(n|N)+ ]] && exit 0
}

command -v toilet &>/dev/null \
    && toilet --gay -f future "\\ \\ \\ tmux sessionizer / / /"
# Get session name
printf "New session name: "
read -r name
[ -z "$name" ] && exit 1

path="$HOME"
program=
case "$1" in
    "zoxide")
        path=$(zoxide query --list | fzf \
                --layout=reverse --preview-window hidden --height=100%)
        [ -z "$path" ] && path="$HOME"
        ;;
    "explicit-path")
        printf "Starting directory: "
        read -r path
        path="${path/\~/$HOME}"
        ;;
    "program")
        printf "Command to run: "
        read -r program
        ;;
    *)
        exit 1
        ;;
esac

confirm "$name" "$path" "$program"
if [ -z "$program" ]; then
    tmux new-session -ds "$name" -c "$path"
else
    tmux new-session -ds "$name" -c "$path" "$program"
fi
tmux switch-client -t "$name"
